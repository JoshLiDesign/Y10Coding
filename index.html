<!DOCTYPE html>
<html>

	<head>
  
		  <!--Import jQuery Library-->
		  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script src="https://www.gstatic.com/firebasejs/5.7.3/firebase.js"></script>
		<!-- Compiled and minified CSS -->
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	    <!-- Compiled and minified JavaScript -->
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/javascript" src="script.js"></script>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

	</head> 
	<!-- body is what user sees --> 
	<body onload="loadcontent()">

			<nav style="background-color: #003444"><a href="#" class="brand-logo center"><i class="large material-icons">search</i>Fenceer</a></nav>
			  <ul id="slide-out" class="sidenav" draggable="true">
			    <li><div class="user-view">
			      <div class="background">
			        <img src="bg.jpg">
			      </div>
                    <a href="#user"><div id = "photo"></div></a>
			      <a href="#name"><div class="white-text name" id = "displayUsername"></div></a>
			      <a href="#email"><span class="white-text email" id = "email"></span></a>
			    </div></li>
			    	 <li><a href="#!"><i class="material-icons">select_all</i>Select Specifications:</a></li>
			    	  <li><div class="divider"></div></li>
			    	<p style="margin-left: 30px">
				    <label style="margin-left: 15px">
				        <input type="checkbox" id="male"/>
				        <span>Male</span>
				      </label>
				      <label style="margin-left: 35px">
				        <input type="checkbox" id="female"/>
				        <span>Female</span>
				      </label>
				  	</p>
				  	 <li><div class="divider"></div></li>
				  	 <p style="margin-left: 20px">
				    <label>
				        <input type="checkbox" id="foil"/>
				        <span>Foil</span>
				      </label>
				      <label style="margin-left: 20px">
				        <input type="checkbox" id="epee"/>
				        <span>Epee</span>
				      </label>
				      <label style="margin-left: 20px">
				        <input type="checkbox" id="sabre"/>
				        <span>Sabre</span>
				      </label>
				  	</p>
				  	<li><div class="divider"></div></li>
				  	 <p style="margin-left: 20px">
				    <label>
				        <input type="checkbox" id="U13"/>
				        <span>U13</span>
				      </label>
				      <label style="margin-left: 31px">
				        <input type="checkbox" id="U15"/>
				        <span>U15</span>
				      </label>
				      <label style="margin-left: 15px">
				        <input type="checkbox" id="cadet"/>
				        <span>Cadet</span>
				      </label>
				  	</p>
				  	<p style="margin-left: 20px">
				    <label>
				        <input type="checkbox" id="junior"/>
				        <span>Junior</span>
				      </label>
				      <label style="margin-left: 15px">
				        <input type="checkbox" id="U23"/>
				        <span>U23</span>
				      </label>
				      <label style="margin-left: 13px">
				        <input type="checkbox" id="senior"/>
				        <span>Senior</span>
				      </label>
				  	</p>
				  	<p style="margin-left: 116px">
				    <label>
				        <input type="checkbox" id="veteran"/>
				        <span>Veteran</span>
				      </label>
				  	</p>
				  	<div class="row">
					    <form class="col s12">
					      <div class="row">
					        <div class="input-field col s12">
					          <input id="organizer" type="text" class="validate">
					          <label for="organizer">Organizer</label>
					        </div>
					      </div>
					      <div class="row">
					        <div class="input-field col s12">
					          <input id="location" type="text" class="validate">
					          <label for="location">Location</label>
					        </div>
					      </div>
					    </form>
					  </div>
				 	<button onclick="loadcontent(), M.toast({html: 'submitted'})" class="waves-effect waves-light btn" style="margin-left: 20px">submit</button>
				 	<button type = "button" class="waves-effect waves-light btn" style="margin-left: 50px; background-color: red" id="login" onclick="loginfunc()"></button> <!--this is log in-->
                    
			  </ul>

			  <nav>
			    <div class="nav-wrapper" style="background-color: #84C2C9; margin-left: 10px">
			      <div class="col s12">
			        <a href="#!" class="breadcrumb" style="margin-left: 10px" id = "gender">?</a>
			        <a href="#!" class="breadcrumb" id = "weapon">?</a>
			        <a href="#!" class="breadcrumb" id = "age">?</a>
			      </div>
			    </div>
			  </nav>

			  <div id = "featurediscovery">

				<div class="fixed-action-btn">
				  <a id = "menu" class="btn-floating btn-large red">
				    <i class="large material-icons">mode_edit</i>
				  </a>
				  <ul>
				    <li><button type= "button" class="btn-floating green" id = "publish" href="https://www.w3schools.com/html/html_links.asp" onclick = "publishpress">  <a href="/user.html" target = "blank"><i class="material-icons" id = "publish">publish</i></a></button></li>
				    <li><a class="btn-floating blue sidenav-trigger" href="#" data-target="slide-out"><i class="material-icons">check_box</i></a></li>
				  </ul>
				</div>  
		
			</div>

		
			<ul class='collapsible popout' id="content">
				
			</ul>
        
        
	<script> 
		M.AutoInit();

        	var query = firebase.database().ref("event").orderByKey();

        	var ismale = document.getElementById("male").checked;
        	function loadcontent(){
	        	query.once("value")
				  .then(function(snapshot) {

				  	var mydiv = document.getElementById("content");
			    	var temp = "";

			    	var strgender = "";
				      if(document.getElementById("male").checked == true)
				      	strgender += "Male, ";
				      if(document.getElementById("female").checked== true)
				      	strgender += "Female, ";
				      if(strgender.charAt(strgender.length-2) == ",")
				      	strgender = strgender.substring(0, strgender.length-2);

				    var strweapon = "";
				      if(document.getElementById("foil").checked == true)
				      	strweapon += "Foil, ";
				      if(document.getElementById("epee").checked== true)
				      	strweapon += "Epee, ";
				      if(document.getElementById("sabre").checked== true)
				      	strweapon += "Sabre, ";
				      if(strweapon.charAt(strweapon.length-2) == ",")
				      	strweapon = strweapon.substring(0, strweapon.length-2);

				    var strgroup = "";
				      if(document.getElementById("U13").checked == true)
				      	strgroup += "U13, ";
				      if(document.getElementById("U15").checked== true)
				      	strgroup += "U15, ";
				      if(document.getElementById("cadet").checked== true)
				      	strgroup += "Cadet, ";
				      if(document.getElementById("junior").checked == true)
				      	strgroup += "Junior, ";
				      if(document.getElementById("U23").checked== true)
				      	strgroup += "U23, ";
				      if(document.getElementById("senior").checked== true)
				      	strgroup += "Senior, ";
				      if(document.getElementById("veteran").checked == true)
				      	strgroup += "Veteran, ";
				      if(strgroup.charAt(strgroup.length-2) == ",")
				      	strgroup = strgroup.substring(0, strgroup.length-2);

				    snapshot.forEach(function(childSnapshot) {

				      var title = childSnapshot.child("title").val();

				      var male = childSnapshot.child("men").val();
				      if(male == true)
				      	male = "Male";
				      if(male == false)
				      	male = "";

				      var female = childSnapshot.child("women").val();
				      if(female == true && male == "Male")
				      	female = "& Female";
				      else if(female == true)
				      	female = "Female";
				      else if(female == false)
				      	female = "";

				      var foil = childSnapshot.child("foil").val();
				      if(foil == true)
				      	foil = "Foil";
				      if(foil == false)
				      	foil = "";

				      var epee = childSnapshot.child("epee").val();
				      if(epee == true && foil == "Foil")
				      	epee = "& Epee";
				      else if(epee == true)
				      	epee = "Epee";
				      else if(epee== false)
				      	epee = "";

				      var sabre = childSnapshot.child("sabre").val();
				      if(sabre == true && (foil == "Foil" || epee == "Epee"))
				      	sabre = "& Sabre";
				      else if(sabre == true)
				      	sabre = "Sabre";
				      else if(sabre == false)
				      	sabre = "";

				      var strage = "";
				      var U13 = childSnapshot.child("U13").val();
				      if(U13 == true)
				      	strage += "U13, ";
				      var U15 = childSnapshot.child("U15").val();
				      if(U15 == true)
				      	strage += "U15, ";
				      var Cadet = childSnapshot.child("cadet").val();
				      if(Cadet == true)
				      	strage += "Cadet, ";
				      var Junior = childSnapshot.child("junior").val();
				      if(Junior == true)
				      	strage += "Junior, ";
				      var U23 = childSnapshot.child("U23").val();
				      if(U23 == true)
				      	strage += "U23, ";
				      var Senior = childSnapshot.child("Senior").val();
				      if(Senior == true)
				      	strage += "Senior, ";
				      var Veteran = childSnapshot.child("Veteran").val();
				      if(Veteran == true)
				      	strage += "Veteran, ";
				      if(strage.charAt(strage.length-2) == ",")
				      	strage = strage.substring(0, strage.length-2);

				      var date = childSnapshot.child("date").val();

				      var location = childSnapshot.child("location").val();

				      var email = childSnapshot.child("email").val();

				      var phone = childSnapshot.child("phone").val();

				      var comment = childSnapshot.child("comment").val();

				      var icons = "";
				      if(childSnapshot.child("foil").val() == true)
				      	icons += "<i class='material-icons'>filter_1</i>"
				      if(childSnapshot.child("epee").val() == true)
				      	icons += "<i class='material-icons'>filter_2</i>"
				      if(childSnapshot.child("sabre").val() == true)
				      	icons += "<i class='material-icons'>filter_3</i>"

				      var ismale = document.getElementById("male").checked;
        			  var isfemale = document.getElementById("female").checked;
        			  var isfoil = document.getElementById("foil").checked;
            		  var isepee = document.getElementById("epee").checked;
            		  var issabre = document.getElementById("sabre").checked;
            		  var isU13 = document.getElementById("U13").checked;
            		  var isU15 = document.getElementById("U15").checked;
            		  var isCadet = document.getElementById("cadet").checked;
            		  var isJunior = document.getElementById("junior").checked;
            		  var isU23 = document.getElementById("U23").checked;
            		  var isSenior = document.getElementById("senior").checked;
            		  var isVeteran = document.getElementById("veteran").checked;

            		  var orgVal = document.getElementById("organizer").value;
            		  var locationVal = document.getElementById("location").value;

        				var shouldadd = true;

        				if(ismale == true && childSnapshot.child("men").val() == false)
        					shouldadd = false;
        				if(isfemale == true && childSnapshot.child("women").val() == false)
        					shouldadd = false;
        				if(isfoil == true && childSnapshot.child("foil").val() == false)
        					shouldadd = false;
        				if(isepee == true && childSnapshot.child("epee").val() == false)
        					shouldadd = false;
        				if(issabre == true && childSnapshot.child("sabre").val() == false)
        					shouldadd = false;
        				if(isU13 == true && childSnapshot.child("U13").val() == false)
        					shouldadd = false;
        				if(isU15 == true && childSnapshot.child("U15").val() == false)
        					shouldadd = false;
        				if(isCadet == true && childSnapshot.child("cadet").val() == false)
        					shouldadd = false;
        				if(isJunior == true && childSnapshot.child("junior").val() == false)
        					shouldadd = false;
        				if(isU23 == true && childSnapshot.child("U23").val() == false)
        					shouldadd = false;
        				if(isSenior == true && childSnapshot.child("Senior").val() == false)
        					shouldadd = false;
        				if(isVeteran == true && childSnapshot.child("Veteran").val() == false)
        					shouldadd = false;

        				if(JSON.stringify(childSnapshot.child("email")).indexOf(orgVal) == -1 && orgVal != "")
        					shouldadd = false;
        				if(JSON.stringify(childSnapshot.child("location")).indexOf(locationVal) == -1 && locationVal != "")
        					shouldadd = false;

        				if(shouldadd){
				      temp += `<li>
				      <div class='collapsible-header' tabindex="0">`+icons+title+`</div>
				      <div class="collapsible-body" style="line-height: 2.0">
				      <span style = "color: red">Gender: </span> `+male+" "+female+`
				      	<br><span style = "color: red">Weapon: </span>`+foil +" "+ epee +" "+sabre+`
				      		<br><span style = "color: red">Age Category: </span>`+strage+`
				      		<br><span style = "color: red">Date: </span>`+date+`
				      		<br><span style = "color: red">Location: </span>`+location+`
				      		<br><span style = "color: red">Email Address: </span>`+email+`
				      		<br><span style = "color: red">Phone Number: </span>`+phone+`
				      		<br><span style = "color: red">Additional Comments: </span>`+comment+`
				      </span></div>
				    </li>`
				}
		
				  });

				  	mydiv.innerHTML = temp;

				  	document.getElementById("gender").innerHTML = strgender;
				  	document.getElementById("weapon").innerHTML = strweapon;
				  	document.getElementById("age").innerHTML = strgroup;
				});
	


			}


            document.getElementById("content")
                .addEventListener("keyup", function(event) {
                event.preventDefault();
                if (event.keyCode === 13) {
                    reply();
                }
            });

	</script>

	</body>
    
</html>